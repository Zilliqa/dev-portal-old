(window.webpackJsonp=window.webpackJsonp||[]).push([[187],{289:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return o})),a.d(t,"rightToc",(function(){return l})),a.d(t,"default",(function(){return p}));var n=a(2),r=a(6),c=(a(0),a(298)),i={id:"core-global-gas-price",title:"Global Gas Price",keywords:["gas","price","computation"],description:"Core protocol design - computing global gas price."},o={id:"contributors/core-global-gas-price",isDocsHomePage:!1,title:"Global Gas Price",description:"Core protocol design - computing global gas price.",source:"@site/docs/contributors/core-gas-computation.md",permalink:"/docs/contributors/core-global-gas-price",editUrl:"https://github.com/Zilliqa/dev-portal/tree/master/docs/contributors/core-gas-computation.md",sidebar:"ContributorsSidebar",previous:{title:"Coinbase Rewards",permalink:"/docs/contributors/core-coinbase"},next:{title:"Guard Mode",permalink:"/docs/contributors/core-guard-mode"}},l=[{value:"Algorithm Inputs",id:"algorithm-inputs",children:[]},{value:"Algorithm Steps",id:"algorithm-steps",children:[{value:"Decreasing the Gas Price",id:"decreasing-the-gas-price",children:[]},{value:"Increasing the Gas Price",id:"increasing-the-gas-price",children:[]}]}],b={rightToc:l};function p(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(c.b)("wrapper",Object(n.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(c.b)("hr",null),Object(c.b)("p",null,"Each miner node's PoW solution comes with a proposed minimum transaction processing gas price that the node is willing to accept. During DS block consensus, the DS committee runs an algorithm to compute the globally acceptable minimum gas price that the entire network will operate on. The DS committee then informs the shards, lookups, and seeds (through ",Object(c.b)("inlineCode",{parentName:"p"},"m_gasPrice")," in the DS block) about the agreed upon global minimum gas price. The network will accept any transaction that has a gas price larger than or equal to the minimum gas price and reject transactions that don't."),Object(c.b)("p",null,"The algorithm to compute the global minimum gas price takes into account:"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"the average ",Object(c.b)("inlineCode",{parentName:"li"},"m_gasPrice")," used over the last ",Object(c.b)("em",{parentName:"li"},"n")," DS epochs"),Object(c.b)("li",{parentName:"ol"},"the average of the gas prices proposed by each individual miner for the next DS epoch (in case a price increase is necessary)"),Object(c.b)("li",{parentName:"ol"},"the trend in network congestion (i.e., the actual consumed gas in the Tx blocks) in the last DS epoch")),Object(c.b)("p",null,"Essentially, the algorithm decides on the gas price depending on the level of network congestion: if network congestion is high, then the miners\nget to have a say on the gas price; otherwise, the minimum gas price should not depend too much on their proposed gas prices."),Object(c.b)("h2",{id:"algorithm-inputs"},"Algorithm Inputs"),Object(c.b)("table",null,Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Global Parameter"),Object(c.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(c.b)("inlineCode",{parentName:"td"},"microblock_gas_limit")),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Gas limit for each micro block")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(c.b)("inlineCode",{parentName:"td"},"num_shards")),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Number of shards in the network, including the DS committee")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(c.b)("inlineCode",{parentName:"td"},"txblock_gas_limit")),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Gas limit for the Tx block (",Object(c.b)("inlineCode",{parentName:"td"},"num_shards x microblock_gas_limit")," for simplicity's sake, although the DS committee has a different gas limit value from the shards)")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(c.b)("inlineCode",{parentName:"td"},"default_min_gas_price")),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"The lowest value that the gas price can take")))),Object(c.b)("table",null,Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Data from Current DS Epoch"),Object(c.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(c.b)("inlineCode",{parentName:"td"},"num_nodes")),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Number of nodes in the network (including the DS committee)")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(c.b)("inlineCode",{parentName:"td"},"proposed_min_price_node[i]")),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Minimum gas price proposed by the ",Object(c.b)("em",{parentName:"td"},"i")," th miner node")))),Object(c.b)("table",null,Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Data from Last ",Object(c.b)("em",{parentName:"th"},"n")," DS Epochs"),Object(c.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(c.b)("inlineCode",{parentName:"td"},"min_price_epoch[j]")),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Global minimum gas price value used in the ",Object(c.b)("em",{parentName:"td"},"j")," th DS epoch")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(c.b)("inlineCode",{parentName:"td"},"consumed_gas_tx_block[j][k]")),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Total consumed gas in the ",Object(c.b)("em",{parentName:"td"},"k")," th Tx block in the ",Object(c.b)("em",{parentName:"td"},"j")," th DS epoch")))),Object(c.b)("h2",{id:"algorithm-steps"},"Algorithm Steps"),Object(c.b)("p",null,"In the following, we describe an algorithm to compute ",Object(c.b)("inlineCode",{parentName:"p"},"global_gas_price")," for the next DS epoch."),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"We first compute ",Object(c.b)("inlineCode",{parentName:"li"},"percentage_full_tx_blocks"),", i.e., the number of Tx blocks mined in the last DS epoch for which the total gas consumed is at least 80% of ",Object(c.b)("inlineCode",{parentName:"li"},"txblock_gas_limit"),". This computation will require checking each ",Object(c.b)("inlineCode",{parentName:"li"},"consumed_gas_tx_block[j][k]"),"."),Object(c.b)("li",{parentName:"ol"},"Then, we make the decision on how to set ",Object(c.b)("inlineCode",{parentName:"li"},"global_gas_price")," according to the table below.")),Object(c.b)("table",null,Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Percentage of Full Blocks"),Object(c.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Interpretation"),Object(c.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Impact on Gas Price"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"< 10%"),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Blocks are mostly empty; demand is low and hence miners should accept a lower price"),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(c.b)("strong",{parentName:"td"},"Increase in the gas price")," compared to the previous epoch")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Between 10% and 70%"),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Blocks are mostly filled; demand and supply have met the sweet spot"),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(c.b)("strong",{parentName:"td"},"No change in the gas price")," compared to the previous epoch")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"> 70%"),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Blocks are heavily filled and hence there is a sign of high demand"),Object(c.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(c.b)("strong",{parentName:"td"},"Decrease in the gas price")," compared to the previous epoch")))),Object(c.b)("h3",{id:"decreasing-the-gas-price"},"Decreasing the Gas Price"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"Discard all ",Object(c.b)("inlineCode",{parentName:"li"},"proposed_min_price_node[i]")," values"),Object(c.b)("li",{parentName:"ol"},"Compute the average gas price over the last ",Object(c.b)("em",{parentName:"li"},"n")," DS epochs:",Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(n.a)({parentName:"pre"},{}),"average_gas_price_val = mean(min_price_epoch[j-1], ..., min_price_epoch[j-n])\n"))),Object(c.b)("li",{parentName:"ol"},"Compute the decreased gas price value:",Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(n.a)({parentName:"pre"},{}),"decreased_gas_price_val = 99% of average_gas_price_val\n"))),Object(c.b)("li",{parentName:"ol"},"Finally, compute the new ",Object(c.b)("inlineCode",{parentName:"li"},"global_gas_price"),":",Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(n.a)({parentName:"pre"},{}),"global_gas_price = min_price_epoch[j] =\n   max(default_min_gas_price, decreased_gas_price_val)\n")))),Object(c.b)("h3",{id:"increasing-the-gas-price"},"Increasing the Gas Price"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"Get the median ",Object(c.b)("inlineCode",{parentName:"li"},"proposed_min_price_node[i]")," value over all values from the ",Object(c.b)("em",{parentName:"li"},"N")," miners:",Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(n.a)({parentName:"pre"},{}),"median_proposed_min_price = median(proposed_min_price_node[1], ..., proposed_min_price_node[N])\n"))),Object(c.b)("li",{parentName:"ol"},"Compute the average gas price over the last ",Object(c.b)("em",{parentName:"li"},"n")," DS epochs:",Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(n.a)({parentName:"pre"},{}),"average_gas_price_val = mean(min_price_epoch[j-1], ..., min_price_epoch[j-n])\n"))),Object(c.b)("li",{parentName:"ol"},"Compute the lower and upper bounds for the increased gas price value:",Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(n.a)({parentName:"pre"},{}),"increased_gas_price_val_lower_bound = 100.5% of average_gas_price_val\nincreased_gas_price_val_upper_bound = 101.5% of average_gas_price_val\n"))),Object(c.b)("li",{parentName:"ol"},"Finally, compute the new ",Object(c.b)("inlineCode",{parentName:"li"},"global_gas_price"),":",Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(n.a)({parentName:"pre"},{}),"global_gas_price = min_price_epoch[j] =\n   max{\n    max[\n         min(median_proposed_min_price, increased_gas_price_val_upper_bound),\n         increased_gas_price_val_lower_bound\n       ],\n    default_min_gas_price\n   }\n")))))}p.isMDXComponent=!0},298:function(e,t,a){"use strict";a.d(t,"a",(function(){return m})),a.d(t,"b",(function(){return u}));var n=a(0),r=a.n(n);function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){c(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var b=r.a.createContext({}),p=function(e){var t=r.a.useContext(b),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},m=function(e){var t=p(e.components);return r.a.createElement(b.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,c=e.originalType,i=e.parentName,b=l(e,["components","mdxType","originalType","parentName"]),m=p(a),d=n,u=m["".concat(i,".").concat(d)]||m[d]||s[d]||c;return a?r.a.createElement(u,o(o({ref:t},b),{},{components:a})):r.a.createElement(u,o({ref:t},b))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var c=a.length,i=new Array(c);i[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:n,i[1]=o;for(var b=2;b<c;b++)i[b]=a[b];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"}}]);