<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<link rel="search" type="application/opensearchdescription+xml" title="Zilliqa Developer Portal" href="/opensearch.xml"><title data-react-helmet="true">Guard Mode | Zilliqa Developer Portal</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Guard Mode | Zilliqa Developer Portal"><meta data-react-helmet="true" name="description" content="Core protocol design - guard mode."><meta data-react-helmet="true" property="og:description" content="Core protocol design - guard mode."><meta data-react-helmet="true" name="keywords" content="core,guard,mode"><meta data-react-helmet="true" property="og:url" content="https://dev.zilliqa.com/docs/contributors/core-guard-mode"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://dev.zilliqa.com/docs/contributors/core-guard-mode"><link rel="stylesheet" href="/styles.90e6c070.css">
<link rel="preload" href="/styles.e6d5f6ad.js" as="script">
<link rel="preload" href="/runtime~main.cfd4d3b6.js" as="script">
<link rel="preload" href="/main.1791fe9a.js" as="script">
<link rel="preload" href="/1.572a4dde.js" as="script">
<link rel="preload" href="/2.69025b56.js" as="script">
<link rel="preload" href="/194.93b79b72.js" as="script">
<link rel="preload" href="/195.8bbd0729.js" as="script">
<link rel="preload" href="/20ac7829.3f24c2c8.js" as="script">
<link rel="preload" href="/17896441.4d4153da.js" as="script">
<link rel="preload" href="/377c28d5.8807781d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.png" alt="Zilliqa Logo"><strong class="navbar__title">Zilliqa Developer Portal</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/basics/basics-intro-blockchain">Basics</a><a class="navbar__item navbar__link" href="/docs/dev/dev-started-introduction">Developers</a><a class="navbar__item navbar__link" href="/docs/apis/api-introduction">APIs</a><a class="navbar__item navbar__link" href="/docs/miners/mining-getting-started">Miners</a><a class="navbar__item navbar__link" href="/docs/exchanges/exchange-getting-started">Exchanges</a><a class="navbar__item navbar__link" href="/docs/staking/staking-overview">Staking</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/contributors/contribute-buildzil">Contributors</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><div class="searchWrapper_-F3-"><span aria-label="expand searchbar" role="button" class="searchIconButton_1Dnz" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_2eto"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.png" alt="Zilliqa Logo"><strong class="navbar__title">Zilliqa Developer Portal</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/basics/basics-intro-blockchain">Basics</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dev/dev-started-introduction">Developers</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/apis/api-introduction">APIs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/miners/mining-getting-started">Miners</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/exchanges/exchange-getting-started">Exchanges</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/staking/staking-overview">Staking</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/contributors/contribute-buildzil">Contributors</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Contributors</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/contribute-buildzil">Building Zilliqa</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/contribute-guidelines">Contribution Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/contribute-standards">Protocol Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/contribute-bug-bounty">Bug Bounty Program</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Core Protocol Design</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Design Overview</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-node-operation">General Node Operation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Consensus Layer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-consensus">Consensus</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-multisignatures">Multisignatures</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Network Layer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-gossip">Gossip</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-broadcasting">Broadcasting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-blacklist">Blacklist</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-messaging-limits">Messaging Limits</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Messaging Layer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-message-dispatch">Message Dispatch and Processing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-message-queues">Message Queues and Jobs</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Data Layer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-incremental-db">Incremental DB</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Directory Service</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-ds-mimo">DS MIMO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-ds-reputation">DS Reputation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Lookup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-websocket-server">WebSocket Server</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-transaction-dispatch">Transaction Dispatch</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-multipliers">Multipliers</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Mining</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-pow">PoW Algorithm</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-difficulty-adjustment">Difficulty Adjustment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-por">Proof of Reputation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-coinbase">Coinbase Rewards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributors/core-global-gas-price">Global Gas Price</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Mitigation Measures</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/contributors/core-guard-mode">Guard Mode</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contributors/core-rejoin-mechanism">Rejoin Mechanism</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contributors/core-view-change">View Change</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contributors/core-diagnostic-data">Diagnostic Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contributors/core-status-server">Status Server</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Guard Mode</h1></header><div class="markdown"><hr><p>Guard mode is a special operating mode in Zilliqa that can be used to maintain stability of the Mainnet until the protocol has been made perfectly robust. Guard mode ensures the following:</p><ul><li>A maximum of <code>n</code> nodes (e.g., 2/3) in the DS committee are nodes operated by Zilliqa Research</li><li>A maximum of <code>n</code> nodes (e.g., 1/3) across all shards are nodes operated by Zilliqa Research</li><li>DS leader selection (in either normal or view change situations) will only include nodes operated by Zilliqa Research</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Guard mode is designed to be toggleable and does not interfere with the standard protocol whether or not it is enabled.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="terminology"></a>Terminology<a aria-hidden="true" tabindex="-1" class="hash-link" href="#terminology" title="Direct link to heading">#</a></h2><ul><li>DS guard - DS node operated by Zilliqa Research</li><li>Shard guard - Shard node operated by Zilliqa Research</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configuration"></a>Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration" title="Direct link to heading">#</a></h2><ol><li>To enable guard mode, set <code>GUARD_MODE</code> to <code>true</code> in <code>constants.xml</code></li><li>Add <code>n</code> DS guard public keys to the <code>ds_guard.DSPUBKEY</code> section in <code>constants.xml</code></li><li>Add <code>n</code> shard guard public keys to the <code>shard_guard.SHARDPUBKEY</code> section in <code>constants.xml</code></li><li>Adjust <code>SHARD_GUARD_TOL</code> in <code>constants.xml</code> to control the maximum percentage of shard guards in each shard</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="normal-operation"></a>Normal Operation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#normal-operation" title="Direct link to heading">#</a></h2><p>A DS guard is designed to be statically placed inside the DS committee. Given <code>n</code> DS guards, the first <code>n</code> slots in the DS committee will be allocated for those DS guards. While in guard mode, these positions do not change or shift during each DS consensus or view change.</p><table><tr><th colspan="2">DS Committee</th></tr><tr><td>1 ... n = DS guards (operated by Zilliqa Research)</td><td>n+1 ... m = non-guard nodes</td></tr></table><p>The DS leader is selected from these DS guards by doing <code>mod n</code> rather than <code>mod m</code>.</p><p>A non-guard node joins the DS committee via <a href="/docs/contributors/core-pow">PoW</a> as usual. If selected, it is inserted in the committee starting at index <code>n+1</code>. Following the <a href="/docs/contributors/core-ds-mimo">DS MIMO</a> convention, the last few DS nodes (non-guards) are ejected from the DS committee to preserve the committee size.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The DS reputation feature (starting Zilliqa version 5.0.0) also impacts DS committee member placement. Please refer to both <a href="/docs/contributors/core-ds-mimo">DS MIMO</a> and <a href="/docs/contributors/core-ds-reputation">DS Reputation</a> sections for more information on how the DS committee membership is managed.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="view-change-operation"></a>View Change Operation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#view-change-operation" title="Direct link to heading">#</a></h2><p>When a view change occurs, it is likely that the DS leader (a DS guard) is faulty or the network failed to agree with what the DS leader proposed. In such a case, the view change candidate leader will be selected from among the <code>n</code> DS guards by doing <code>mod n</code> rather than <code>mod m</code>.</p><p>Upon view change completion, there is no shifting of the DS guard nodes, i.e., the DS guards stay in place (even the faulty ones). The shard nodes who receive the generated VC block will also not adjust these nodes in their own view of the DS committee.</p><p>After the view change, the DS committee updates their <code>m_consensusLeaderID</code> to the new leader and the protocol resumes.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="shard-guard-design"></a>Shard Guard Design<a aria-hidden="true" tabindex="-1" class="hash-link" href="#shard-guard-design" title="Direct link to heading">#</a></h2><p>Shard guards are placed within shards in a manner such that there is a sufficient number of these Zilliqa-operated nodes in every shard. Shard guards are special as:</p><ul><li>They only do PoW with difficulty 1</li><li>They cannot join the DS committee (hence, they only perform PoW to enter a shard)</li><li>Their PoW submissions are given priority by the DS committee over normal shard nodes&#x27; submissions</li></ul><p>After the PoW window is over, the DS committee will begin to compose the sharding structure. The DS leader, as per the protocol, will trim the list of nodes such that each shard will be expected to have exactly <code>COMM_SIZE</code> number of nodes. In guard mode, shard guards are given priority during the trimming, which means non-guard nodes are trimmed away first. With the trimmed list, the DS leader will then randomly assign each node (shard guard and non-shard guard) to its respective shard.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="shard-rebalancing"></a>Shard Rebalancing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#shard-rebalancing" title="Direct link to heading">#</a></h2><p>When determining the shard composition - particularly in the event that the number of shards in the new DS epoch is lower than in the previous one - we must ensure that the newly composed shards will not be entirely made up of guards.</p><p>To do this, we trim the overall number of shard guards to 1/3 of the expected population (e.g., 600 out of 1800), and then complete the count with non-shard guards. However, in the event when there is not enough nodes to make up the EXPECTED_SHARD_NODE_NUM, the additional shard guards will fill up the gaps.</p><p>Keywords to look for in the logs:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-console codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DS leader:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trimmedGuardCount: [some value] trimmedNonGuardCount: [some value] Total number of accepted soln: [some value]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Example:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">trimmedGuardCount: 40 trimmedNonGuardCount: 80 Total number of accepted soln: 120</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="shard-leader-selection"></a>Shard Leader Selection<a aria-hidden="true" tabindex="-1" class="hash-link" href="#shard-leader-selection" title="Direct link to heading">#</a></h2><p>A best effort approach for selecting a shard guard as the shard leader was introduced in <a href="https://github.com/Zilliqa/Zilliqa/pull/1513" target="_blank" rel="noopener noreferrer">PR 1513</a>.</p><p>Whether or not guard mode is enabled, the basic formula for calculating the new shard leader is:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-console codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Leader index = last block hash % shard size</span></div></div></div></div></div><p>In guard mode, the calculation is invoked repeatedly as follows:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-console codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Leader index = last block hash % shard size</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">while leader is not a shard guard (iterate up to SHARD_LEADER_SELECT_TOL times)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Hash = sha2(last block hash)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Leader index = Hash % shard size</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="runtime-validation"></a>Runtime Validation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#runtime-validation" title="Direct link to heading">#</a></h2><p>Guard mode is designed to work when the following assumption holds:</p><ul><li>number of new DS nodes injected into the shards &gt;= number of allowed non-guard shard nodes</li></ul><p>Using a simple local run as an example:</p><ul><li>Number of nodes: 20</li><li>DS nodes: 10</li><li>Shard size: 5</li><li>DS MIMO: 2</li></ul><table><tr><th colspan="2">DS Committee</th></tr><tr><td>DS guards (8)</td><td>Non-guards (2)</td></tr></table><table><tr><th colspan="2">Shard 1</th></tr><tr><td>Shard guards (4)</td><td>Non-guards (1)</td></tr></table><table><tr><th colspan="2">Shard 2</th></tr><tr><td>Shard guards (4)</td><td>Non-guards (1)</td></tr></table><p>In this example, if the network is reduced from 2 shards to 1, the DS MIMO process will inject more nodes (the 2 oldest non-guard DS nodes) into the shard than the shard limit (5).</p><table><tr><th colspan="2">DS Committee</th></tr><tr><td>DS guards (8)</td><td>Non-guards (2)</td></tr></table><table><tr><th colspan="2">Shard 1</th></tr><tr><td>Shard guards (4)</td><td><b>Non-guards (2)</b></td></tr></table><p>There is no easy solution around it. Hence, <code>ValidateRunTimeEnvironment()</code> checks for such a condition and terminates the node with a log message if it happens.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="changing-network-information-of-ds-guards"></a>Changing Network Information of DS Guards<a aria-hidden="true" tabindex="-1" class="hash-link" href="#changing-network-information-of-ds-guards" title="Direct link to heading">#</a></h2><p>It is not uncommon for nodes in the network to go down and then attempt to rejoin under a different IP address. Under normal operation without guard mode, faulty DS nodes can be gracefully kicked out of the DS committee using regular shifting and view change if necessary. However, in guard mode, DS guards do not shift and stay in the DS committee indefinitely. As such, we can possibly lose a node forever if the DS guard has gone down and changed its IP address.</p><p>To address this situation, we have devised a simple protocol for the DS guard to rejoin and update the network about its new information.</p><p>The steps are:</p><ol><li>DS guard goes down and restarts with (possibly) a different IP address</li><li>DS guard completes rejoin sequence and enters <code>FinishRejoinAsDS()</code></li><li>DS guard broadcasts its updated information (pubkey, network info, and timestamp) to the lookups, and gossips the same to the DS committee</li><li>DS committee and lookup update their view of the DS committee</li><li>Lookup stores the updated information</li><li>At the next vacuous epoch, all shard nodes query the lookup for any updated DS guard network information</li><li>Lookup will not respond if there is no new information</li><li>Otherwise, lookup sends the information to the requesting shard nodes</li><li>The requesting shard nodes verify the message and update their view of the DS committee</li></ol><img alt="Guard Mode Image 1" src="/img/contributors/core/guard-mode/image01.png"></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Zilliqa/dev-portal/tree/master/docs/contributors/core-guard-mode.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/contributors/core-global-gas-price"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Global Gas Price</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/contributors/core-rejoin-mechanism"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Rejoin Mechanism »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#terminology" class="table-of-contents__link">Terminology</a></li><li><a href="#configuration" class="table-of-contents__link">Configuration</a></li><li><a href="#normal-operation" class="table-of-contents__link">Normal Operation</a></li><li><a href="#view-change-operation" class="table-of-contents__link">View Change Operation</a></li><li><a href="#shard-guard-design" class="table-of-contents__link">Shard Guard Design</a></li><li><a href="#shard-rebalancing" class="table-of-contents__link">Shard Rebalancing</a></li><li><a href="#shard-leader-selection" class="table-of-contents__link">Shard Leader Selection</a></li><li><a href="#runtime-validation" class="table-of-contents__link">Runtime Validation</a></li><li><a href="#changing-network-information-of-ds-guards" class="table-of-contents__link">Changing Network Information of DS Guards</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Developer Groups</h4><ul class="footer__items"><li class="footer__item"><a href="https://discord.com/invite/XMRE9tt" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://t.me/ZilliqaDevs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/zilliqa" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCvinnFbf0u71cajoxKcfZIQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Other Links</h4><ul class="footer__items"><li class="footer__item"><a href="https://blog.zilliqa.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/zilliqa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2019 Zilliqa Research Pte. Ltd.</div></div></div></footer></div>
<script src="/styles.e6d5f6ad.js"></script>
<script src="/runtime~main.cfd4d3b6.js"></script>
<script src="/main.1791fe9a.js"></script>
<script src="/1.572a4dde.js"></script>
<script src="/2.69025b56.js"></script>
<script src="/194.93b79b72.js"></script>
<script src="/195.8bbd0729.js"></script>
<script src="/20ac7829.3f24c2c8.js"></script>
<script src="/17896441.4d4153da.js"></script>
<script src="/377c28d5.8807781d.js"></script>
</body>
</html>